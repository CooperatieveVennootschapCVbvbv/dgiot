%% This config file is the very basic config to compile emqx
%% This allows emqx to be used as a dependency for other applications
%% such as emqx module/plugin develpments and tests.

%% With the help of EMQ's rebar3 fork, the config is extended
%% with rebar.config.erl module. Final result is written to
%% rebar.config.rendered if environment DEBUG is set.

{edoc_opts, [{preprocess,true}]}.
{erl_opts, [warn_unused_vars,warn_shadow_vars,warn_unused_import,
            warn_obsolete_guard,compressed,
            {d, snk_kind, msg}]}.

{extra_src_dirs, [{"etc", [{recursive,true}]}]}.

{xref_checks,[undefined_function_calls,undefined_functions,locals_not_used,
              deprecated_function_calls,warnings_as_errors,deprecated_functions]}.

{dialyzer, [
    {warnings, [unmatched_returns, error_handling, race_conditions]},
    {plt_location, "."},
    {plt_prefix, "emqx_dialyzer"},
    {plt_apps, all_apps},
    {statistics, true}
   ]
}.

{cover_opts, [verbose]}.
{cover_export_enabled, true}.
{cover_excl_mods, [emqx_exproto_pb, emqx_exhook_pb]}.

{provider_hooks, [{pre, [{release, {relup_helper, gen_appups}}]}]}.

{post_hooks,[]}.

{erl_first_files, ["src/emqx_logger.erl", "src/emqx_rule_actions_trans.erl"]}.

{deps,
    [{gun, {git, "https://gitee.com/fastdgiot/gun", {tag, "1.3.5"}}}
    , {ssl_verify_fun, {git, "https://gitee.com/fastdgiot/ssl_verify_fun.erl.git", {tag, "1.1.4"}}}
    , {erlydtl, {git, "https://gitee.com/fastdgiot/erlydtl.git", {tag, "0.12.1"}}}
    , {erlport, {git, "https://gitee.com/fastdgiot/erlport", {tag, "v1.2.2"}}}
    , {poolboy, {git, "https://gitee.com/fastdgiot/poolboy.git", {tag, "1.5.3"}}}
    , {ibrowse, {git, "https://gitee.com/fastdgiot/ibrowse.git", {tag, "v4.4.2"}}}
    , {jwerl, {git, "https://gitee.com/fastdgiot/jwerl.git", {tag, "1.1.1"}}}
    ]}.

{xref_ignores,
 [ %% schema registry is for enterprise
  {emqx_schema_registry,get_all_schemas,0},
  {emqx_schema_api,format_schema,1},
  {emqx_schema_api,make_schema_params,1},
  {emqx_schema_parser,decode,3},
  {emqx_schema_parser,encode,3},
  {emqx_schema_registry,add_schema,1},
  emqx_exhook_pb, % generated code for protobuf
  emqx_exproto_pb % generated code for protobuf
]}.
